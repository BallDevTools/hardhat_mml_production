<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BSC Testnet Scenario Tester</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.8.0/web3.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .dashboard {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .card h3 {
      margin-bottom: 20px;
      color: #1e3c72;
      font-size: 1.3rem;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #2d3748;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #1e3c72;
    }

    .btn {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      margin: 5px;
      display: inline-block;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 60, 114, 0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-danger {
      background: linear-gradient(135deg, #e53e3e 0%, #fc8181 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #38a169 0%, #68d391 100%);
    }

    .btn-warning {
      background: linear-gradient(135deg, #d69e2e 0%, #f6e05e 100%);
    }

    .btn-info {
      background: linear-gradient(135deg, #3182ce 0%, #63b3ed 100%);
    }

    .scenario-builder {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #1e3c72;
    }

    .scenario-step {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .step-info {
      flex: 1;
      margin-right: 15px;
    }

    .step-actions {
      display: flex;
      gap: 5px;
    }

    .wallet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .wallet-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s;
    }

    .wallet-card.connected {
      border-color: #68d391;
      background: rgba(72, 187, 120, 0.05);
    }

    .wallet-card.member {
      border-color: #3182ce;
      background: rgba(49, 130, 206, 0.05);
    }

    .wallet-info {
      margin-bottom: 10px;
    }

    .wallet-name {
      font-weight: bold;
      color: #1e3c72;
      font-size: 1.1rem;
    }

    .wallet-address {
      font-family: monospace;
      font-size: 0.9rem;
      color: #666;
      word-break: break-all;
    }

    .wallet-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0;
      font-size: 0.9rem;
    }

    .stat-item {
      background: #f8f9fa;
      padding: 8px;
      border-radius: 5px;
      text-align: center;
    }

    .stat-label {
      color: #666;
      font-size: 0.8rem;
    }

    .stat-value {
      font-weight: bold;
      color: #1e3c72;
    }

    .execution-panel {
      background: #1a202c;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 10px;
      height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 8px;
      border-radius: 4px;
      border-left: 4px solid transparent;
    }

    .log-success {
      background-color: rgba(72, 187, 120, 0.2);
      border-left-color: #48bb78;
    }

    .log-error {
      background-color: rgba(245, 101, 101, 0.2);
      border-left-color: #f56565;
    }

    .log-info {
      background-color: rgba(66, 153, 225, 0.2);
      border-left-color: #4299e1;
    }

    .log-warning {
      background-color: rgba(236, 201, 75, 0.2);
      border-left-color: #ecc94b;
    }

    .predefined-scenarios {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .scenario-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .scenario-card:hover {
      border-color: #1e3c72;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
    }

    .scenario-title {
      font-weight: bold;
      color: #1e3c72;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .scenario-description {
      color: #666;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1e3c72, #2a5298);
      width: 0%;
      transition: width 0.3s ease;
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-pending {
      background: #ecc94b;
    }

    .status-running {
      background: #4299e1;
      animation: pulse 1s infinite;
    }

    .status-success {
      background: #48bb78;
    }

    .status-error {
      background: #f56565;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .network-status {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .network-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #68d391;
    }

    .network-indicator.disconnected {
      background-color: #fc8181;
    }

    .tx-link {
      color: #3182ce;
      text-decoration: none;
      font-weight: bold;
    }

    .tx-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }

      .wallet-grid {
        grid-template-columns: 1fr;
      }

      .predefined-scenarios {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üß™ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå BSC Testnet</h1>
      <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏™‡πÄ‡∏Ñ‡∏™‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏ô Blockchain</p>
    </div>

    <!-- Network Status -->
    <div class="card">
      <div class="network-status">
        <div id="networkIndicator" class="network-indicator disconnected"></div>
        <span id="networkName">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö BSC Testnet</span>
        <button class="btn btn-success" onclick="connectToNetwork()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Wallet</button>
        <button class="btn btn-info" onclick="addBSCTestnet()">‡πÄ‡∏û‡∏¥‡πà‡∏° BSC Testnet</button>
      </div>
    </div>

    <div class="dashboard">
      <!-- Scenario Builder -->
      <div class="card">
        <h3>üéØ ‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>

        <!-- Predefined Scenarios -->
        <div class="predefined-scenarios">
          <div class="scenario-card" onclick="loadScenario('chain_registration')">
            <div class="scenario-title">üìà ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡πÇ‡∏ã‡πà</div>
            <div class="scenario-description">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ A ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô B-Z ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ï‡πâ A ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏û‡∏•‡∏ô 1</div>
          </div>

          <div class="scenario-card" onclick="loadScenario('multi_plan_test')">
            <div class="scenario-title">üé≤ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏û‡∏•‡∏ô</div>
            <div class="scenario-description">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏•‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ú‡∏™‡∏°‡∏Å‡∏±‡∏ô</div>
          </div>

          <div class="scenario-card" onclick="loadScenario('upgrade_sequence')">
            <div class="scenario-title">‚¨ÜÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÅ‡∏û‡∏•‡∏ô‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö</div>
            <div class="scenario-description">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÅ‡∏û‡∏•‡∏ô‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
          </div>

          <div class="scenario-card" onclick="loadScenario('custom')">
            <div class="scenario-title">üîß ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</div>
            <div class="scenario-description">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏™‡πÄ‡∏Ñ‡∏™‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</div>
          </div>
        </div>

        <!-- Custom Scenario Builder -->
        <div id="customBuilder" style="display: none;">
          <div class="scenario-builder">
            <h4>‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏™‡πÄ‡∏Ñ‡∏™‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</h4>
            <div class="form-group">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏™‡πÄ‡∏Ñ‡∏™:</label>
              <input type="text" id="testCaseName" placeholder="‡πÄ‡∏ó‡∏™‡πÄ‡∏Ñ‡∏™‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô">
            </div>
            <div class="form-group">
              <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Test Wallets:</label>
              <input type="number" id="walletCount" value="5" min="2" max="26">
            </div>
            <div class="form-group">
              <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô USDT ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</label>
              <input type="number" id="autoApproveAmount" value="100" min="1">
            </div>
            <button class="btn btn-success" onclick="generateTestWallets()">‡∏™‡∏£‡πâ‡∏≤‡∏á Test Wallets</button>
          </div>
        </div>

        <!-- Execution Controls -->
        <div style="margin-top: 20px;">
          <button class="btn btn-success" onclick="executeScenario()" id="executeBtn" disabled>üöÄ
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå</button>
          <button class="btn btn-warning" onclick="pauseExecution()" id="pauseBtn" disabled>‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
          <button class="btn btn-danger" onclick="stopExecution()" id="stopBtn" disabled>‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
          <button class="btn btn-info" onclick="resetScenario()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>

        <!-- Progress -->
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="progressText">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>
      </div>

      <!-- Execution Panel -->
      <div class="card">
        <h3>üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h3>
        <button class="btn" onclick="clearLog()" style="float: right; margin-top: -50px;">‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <div class="execution-panel" id="executionLog">
          <div class="log-entry log-info">[00:00:00] üß™ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå BSC Testnet ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!</div>
          <div class="log-entry log-info">[00:00:00] üí° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>
        </div>
      </div>
    </div>

    <!-- Test Wallets Grid -->
    <div class="card">
      <h3>üëõ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Test Wallets</h3>
      <div class="wallet-grid" id="walletGrid">
        <!-- Wallets will be generated here -->
      </div>
    </div>

    <!-- Contract Information -->
    <div class="card">
      <h3>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ç‡∏ç‡∏≤</h3>
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
        <p><strong>FakeUSDT:</strong> <span
            style="font-family: monospace;">0xA2e4112adDe3Bd3E0458e51f7617a9823234680f</span></p>
        <p><strong>CryptoMembershipNFT:</strong> <span
            style="font-family: monospace;">0x148B98CA32A7231169a7B256E91F9454055B7C29</span></p>
        <p><strong>Owner:</strong> <span
            style="font-family: monospace;">0x2D6b2D23730d8737225146e74975B1273Dc005AF</span></p>
        <p><strong>BSC Testnet Explorer:</strong> <a href="https://testnet.bscscan.com/" target="_blank"
            class="tx-link">https://testnet.bscscan.com/</a></p>
      </div>
    </div>
  </div>
  <script>
    // Contract addresses and ABIs (same as before)
    const FAKE_USDT_ADDRESS = '0xA2e4112adDe3Bd3E0458e51f7617a9823234680f';
    const CRYPTO_MEMBERSHIP_NFT_ADDRESS = '0x148B98CA32A7231169a7B256E91F9454055B7C29';
    const OWNER_ADDRESS = '0x2D6b2D23730d8737225146e74975B1273Dc005AF';

    // Simplified ABIs for testing
    const NFT_ABI = [
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "_usdtToken",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "initialOwner",
            "type": "address"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [],
        "name": "AlreadyMember",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "CooldownActive",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ERC721EnumerableForbiddenBatchMint",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "sender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          },
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "ERC721IncorrectOwner",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "ERC721InsufficientApproval",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "approver",
            "type": "address"
          }
        ],
        "name": "ERC721InvalidApprover",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          }
        ],
        "name": "ERC721InvalidOperator",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "ERC721InvalidOwner",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "receiver",
            "type": "address"
          }
        ],
        "name": "ERC721InvalidReceiver",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "sender",
            "type": "address"
          }
        ],
        "name": "ERC721InvalidSender",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "ERC721NonexistentToken",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "index",
            "type": "uint256"
          }
        ],
        "name": "ERC721OutOfBoundsIndex",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "EmptyName",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "EmptyURI",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InactivePlan",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidAmount",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidCycleMembers",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidDecimals",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidPlanID",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidRequest",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "InvalidRequests",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "LowFeeBalance",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "LowFundBalance",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "LowOwnerBalance",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NextPlanOnly",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NoPlanImage",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NoRequest",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NonTransferable",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NonexistentToken",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NotMember",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "NotPaused",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "OwnableInvalidOwner",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          }
        ],
        "name": "OwnableUnauthorizedAccount",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "Paused",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "Plan1Only",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "PriceTooLow",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ReentrancyGuardReentrantCall",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ReentrantTransfer",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "token",
            "type": "address"
          }
        ],
        "name": "SafeERC20FailedOperation",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ThirtyDayLock",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "TimelockActive",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "TooSoon",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "UplineNotMember",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "UplinePlanLow",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ZeroAddress",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ZeroBalance",
        "type": "error"
      },
      {
        "inputs": [],
        "name": "ZeroPrice",
        "type": "error"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "approved",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "Approval",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "operator",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "bool",
            "name": "approved",
            "type": "bool"
          }
        ],
        "name": "ApprovalForAll",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "totalOwner",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "totalFee",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "totalFund",
            "type": "uint256"
          }
        ],
        "name": "BatchWithdrawalProcessed",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "bool",
            "name": "status",
            "type": "bool"
          }
        ],
        "name": "ContractPaused",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "EmergencyWithdraw",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "timestamp",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "EmergencyWithdrawInitiated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "timestamp",
            "type": "uint256"
          }
        ],
        "name": "EmergencyWithdrawRequested",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "ownerAmount",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "feeAmount",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "fundAmount",
            "type": "uint256"
          }
        ],
        "name": "FundsDistributed",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "member",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "refundAmount",
            "type": "uint256"
          }
        ],
        "name": "MemberExited",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "member",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "upline",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "cycleNumber",
            "type": "uint256"
          }
        ],
        "name": "MemberRegistered",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "string",
            "name": "message",
            "type": "string"
          }
        ],
        "name": "MembershipMinted",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "string",
            "name": "newURI",
            "type": "string"
          }
        ],
        "name": "MetadataUpdated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "cycleNumber",
            "type": "uint256"
          }
        ],
        "name": "NewCycleStarted",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "previousOwner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "OwnershipTransferred",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "price",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "membersPerCycle",
            "type": "uint256"
          }
        ],
        "name": "PlanCreated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "string",
            "name": "imageURI",
            "type": "string"
          }
        ],
        "name": "PlanDefaultImageSet",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "member",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "oldPlanId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "newPlanId",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "cycleNumber",
            "type": "uint256"
          }
        ],
        "name": "PlanUpgraded",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "newPriceFeed",
            "type": "address"
          }
        ],
        "name": "PriceFeedUpdated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "ReferralPaid",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "newDuration",
            "type": "uint256"
          }
        ],
        "name": "TimelockUpdated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "TransferAttemptBlocked",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "upline",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "downline",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "downlineCurrentPlan",
            "type": "uint256"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "downlineTargetPlan",
            "type": "uint256"
          }
        ],
        "name": "UplineNotified",
        "type": "event"
      },
      {
        "inputs": [],
        "name": "MAX_MEMBERS_PER_CYCLE",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "TIMELOCK_DURATION",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "components": [
              {
                "internalType": "address",
                "name": "recipient",
                "type": "address"
              },
              {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
              },
              {
                "internalType": "uint256",
                "name": "balanceType",
                "type": "uint256"
              }
            ],
            "internalType": "struct CryptoMembershipNFT.WithdrawalRequest[]",
            "name": "requests",
            "type": "tuple[]"
          }
        ],
        "name": "batchWithdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "cancelEmergencyWithdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_price",
            "type": "uint256"
          },
          {
            "internalType": "string",
            "name": "_name",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "_membersPerCycle",
            "type": "uint256"
          }
        ],
        "name": "createPlan",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "emergencyWithdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "exitMembership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "getApproved",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getContractStatus",
        "outputs": [
          {
            "internalType": "bool",
            "name": "isPaused",
            "type": "bool"
          },
          {
            "internalType": "uint256",
            "name": "totalBalance",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "memberCount",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "currentPlanCount",
            "type": "uint256"
          },
          {
            "internalType": "bool",
            "name": "hasEmergencyRequest",
            "type": "bool"
          },
          {
            "internalType": "uint256",
            "name": "emergencyTimeRemaining",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_tokenId",
            "type": "uint256"
          }
        ],
        "name": "getNFTImage",
        "outputs": [
          {
            "internalType": "string",
            "name": "imageURI",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "description",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "createdAt",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_planId",
            "type": "uint256"
          }
        ],
        "name": "getPlanCycleInfo",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "currentCycle",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "membersInCurrentCycle",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "membersPerCycle",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "_member",
            "type": "address"
          }
        ],
        "name": "getReferralChain",
        "outputs": [
          {
            "internalType": "address[]",
            "name": "",
            "type": "address[]"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getSystemStats",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "totalMembers",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "totalRevenue",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "totalCommission",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "ownerFunds",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "feeFunds",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "fundFunds",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          }
        ],
        "name": "isApprovedForAll",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "isTokenTransferable",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "pure",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "name": "members",
        "outputs": [
          {
            "internalType": "address",
            "name": "upline",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "totalReferrals",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "totalEarnings",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "cycleNumber",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "registeredAt",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "name",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "ownerOf",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "planCycles",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "currentCycle",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "membersInCurrentCycle",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "planDefaultImages",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "plans",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "price",
            "type": "uint256"
          },
          {
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "membersPerCycle",
            "type": "uint256"
          },
          {
            "internalType": "bool",
            "name": "isActive",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "priceFeed",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_planId",
            "type": "uint256"
          },
          {
            "internalType": "address",
            "name": "_upline",
            "type": "address"
          }
        ],
        "name": "registerMember",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "renounceOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "requestEmergencyWithdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "restartAfterPause",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "safeTransferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          },
          {
            "internalType": "bytes",
            "name": "data",
            "type": "bytes"
          }
        ],
        "name": "safeTransferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          },
          {
            "internalType": "bool",
            "name": "approved",
            "type": "bool"
          }
        ],
        "name": "setApprovalForAll",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "string",
            "name": "baseURI",
            "type": "string"
          }
        ],
        "name": "setBaseURI",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "bool",
            "name": "_paused",
            "type": "bool"
          }
        ],
        "name": "setPaused",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_planId",
            "type": "uint256"
          },
          {
            "internalType": "string",
            "name": "_imageURI",
            "type": "string"
          }
        ],
        "name": "setPlanDefaultImage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_planId",
            "type": "uint256"
          },
          {
            "internalType": "bool",
            "name": "_isActive",
            "type": "bool"
          }
        ],
        "name": "setPlanStatus",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "_priceFeed",
            "type": "address"
          }
        ],
        "name": "setPriceFeed",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "bytes4",
            "name": "interfaceId",
            "type": "bytes4"
          }
        ],
        "name": "supportsInterface",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "symbol",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "index",
            "type": "uint256"
          }
        ],
        "name": "tokenByIndex",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "tokenImages",
        "outputs": [
          {
            "internalType": "string",
            "name": "imageURI",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "name",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "description",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "planId",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "createdAt",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "index",
            "type": "uint256"
          }
        ],
        "name": "tokenOfOwnerByIndex",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_tokenId",
            "type": "uint256"
          }
        ],
        "name": "tokenURI",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "totalSupply",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "transferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "transferOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_planId",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "_newMembersPerCycle",
            "type": "uint256"
          }
        ],
        "name": "updateMembersPerCycle",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_newPlanId",
            "type": "uint256"
          }
        ],
        "name": "upgradePlan",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "usdtToken",
        "outputs": [
          {
            "internalType": "contract IERC20",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "validateContractBalance",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "withdrawFeeSystemBalance",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "withdrawFundBalance",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "withdrawOwnerBalance",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    const USDT_ABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "allowance",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "needed",
            "type": "uint256"
          }
        ],
        "name": "ERC20InsufficientAllowance",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "sender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "balance",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "needed",
            "type": "uint256"
          }
        ],
        "name": "ERC20InsufficientBalance",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "approver",
            "type": "address"
          }
        ],
        "name": "ERC20InvalidApprover",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "receiver",
            "type": "address"
          }
        ],
        "name": "ERC20InvalidReceiver",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "sender",
            "type": "address"
          }
        ],
        "name": "ERC20InvalidSender",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          }
        ],
        "name": "ERC20InvalidSpender",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "OwnableInvalidOwner",
        "type": "error"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          }
        ],
        "name": "OwnableUnauthorizedAccount",
        "type": "error"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "Approval",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "previousOwner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "OwnershipTransferred",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          }
        ],
        "name": "allowance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "burn",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "burnFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "decimals",
        "outputs": [
          {
            "internalType": "uint8",
            "name": "",
            "type": "uint8"
          }
        ],
        "stateMutability": "pure",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "faucet",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "mint",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "name",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "renounceOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "symbol",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "totalSupply",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "transfer",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "transferFrom",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "transferOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    // BSC Testnet configuration
    const BSC_TESTNET = {
      chainId: '0x61',
      chainName: 'BSC Testnet',
      nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
      rpcUrls: ['https://bsc-testnet-dataseed.bnbchain.org'],
      blockExplorerUrls: ['https://testnet.bscscan.com/']
    };

    // Global variables
    let web3, currentAccount, nftContract, usdtContract;
    let testWallets = [];
    let currentScenario = null;
    let isExecuting = false;
    let isPaused = false;
    let currentStep = 0;
    let executionStartTime = 0;

    // Predefined scenarios
    const scenarios = {
      chain_registration: {
        name: "Chain Registration Test",
        description: "User A registers first, then B-Z register under A",
        steps: [
          { action: "setup_wallets", params: { count: 10 } },
          { action: "fund_wallets", params: { amount: "50" } },
          { action: "register_first", params: { wallet: 0, plan: 1 } },
          { action: "register_chain", params: { wallets: [1, 2, 3, 4, 5, 6, 7, 8, 9], upline: 0, plan: 1 } }
        ]
      },
      // üîπ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç multi_plan_test ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á
      multi_plan_test: {
        name: "Realistic Multi-Plan Test",
        description: "Users register Plan 1 first, then upgrade to different plans",
        steps: [
          { action: "setup_wallets", params: { count: 8 } },
          { action: "fund_wallets", params: { amount: "300" } }, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö upgrade

          // Step 1: ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ Plan 1 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏Å‡πà‡∏≠‡∏ô
          { action: "register_first", params: { wallet: 0, plan: 1 } },
          { action: "register_chain", params: { wallets: [1, 2, 3, 4, 5, 6, 7], upline: 0, plan: 1 } },

          // Step 2: Upgrade ‡πÄ‡∏õ‡πá‡∏ô Plan ‡∏ï‡πà‡∏≤‡∏á‡πÜ
          {
            action: "upgrade_multi_plan", params: {
              upgrades: [
                { wallet: 1, targetPlan: 2 }, // B: 1‚Üí2
                { wallet: 2, targetPlan: 3 }, // C: 1‚Üí2‚Üí3
                { wallet: 3, targetPlan: 1 }, // D: ‡πÑ‡∏°‡πà upgrade (‡∏≠‡∏¢‡∏π‡πà Plan 1)
                { wallet: 4, targetPlan: 2 }, // E: 1‚Üí2
                { wallet: 5, targetPlan: 4 }, // F: 1‚Üí2‚Üí3‚Üí4
                { wallet: 6, targetPlan: 1 }, // G: ‡πÑ‡∏°‡πà upgrade (‡∏≠‡∏¢‡∏π‡πà Plan 1)
                { wallet: 7, targetPlan: 3 }  // H: 1‚Üí2‚Üí3
              ]
            }
          }
        ]
      },
      upgrade_sequence: {
        name: "Plan Upgrade Sequence Test",
        description: "Test sequential plan upgrades",
        steps: [
          { action: "setup_wallets", params: { count: 5 } },
          { action: "fund_wallets", params: { amount: "200" } },
          { action: "register_first", params: { wallet: 0, plan: 1 } },
          { action: "register_chain", params: { wallets: [1, 2, 3, 4], upline: 0, plan: 1 } },
          {
            action: "upgrade_sequence", params: {
              upgrades: [
                { wallet: 0, targetPlan: 5 },
                { wallet: 1, targetPlan: 3 },
                { wallet: 2, targetPlan: 4 }
              ]
            }
          }
        ]
      },
      // üîπ ‡πÄ‡∏û‡∏¥‡πà‡∏° scenario ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Owner
      owner_multi_plan_test: {
        name: "Owner Multi-Plan Test",
        description: "Owner registers multiple plans, then users join",
        steps: [
          { action: "setup_wallets", params: { count: 5 } },
          { action: "fund_wallets", params: { amount: "100" } },

          // Owner ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏•‡∏≤‡∏¢ Plan (Owner ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡πâ‡∏≤‡∏° Plan ‡πÑ‡∏î‡πâ)
          {
            action: "owner_register_multi", params: {
              plans: [1, 3, 5, 8] // Owner ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ Plan 1, 3, 5, 8
            }
          },

          // Users ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ Owner
          {
            action: "register_multi_plan", params: {
              registrations: [
                { wallet: 1, plan: 1, upline: 0 }, // B ‚Üí A (Plan 1)
                { wallet: 2, plan: 1, upline: 0 }, // C ‚Üí A (Plan 1) 
                { wallet: 3, plan: 1, upline: 0 }, // D ‚Üí A (Plan 1)
                { wallet: 4, plan: 1, upline: 0 }  // E ‚Üí A (Plan 1)
              ]
            }
          }
        ]
      },
      custom: {
        name: "Custom Scenario",
        description: "Build your own test case",
        steps: []
      }
    };


    async function upgradeMultiPlan(upgrades) {
      for (const upgrade of upgrades) {
        if (!isExecuting) break;

        if (upgrade.targetPlan > 1) {
          // ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ upgrade ‡∏à‡∏£‡∏¥‡∏á
          await upgradeWalletPlan(upgrade.wallet, upgrade.targetPlan);
        } else {
          // ‡πÑ‡∏°‡πà upgrade (‡∏≠‡∏¢‡∏π‡πà Plan 1)
          logMessage(`‚ÑπÔ∏è ${testWallets[upgrade.wallet].name} stays at Plan 1`, 'info');
        }
        await sleep(2000);
      }
    }

    async function registerOwner(planId) {
      try {
        // ‡πÄ‡∏ä‡πá‡∏Ñ allowance
        const allowance = await usdtContract.methods.allowance(currentAccount, CRYPTO_MEMBERSHIP_NFT_ADDRESS).call();
        const plan = await nftContract.methods.plans(planId).call();

        if (BigInt(allowance) < BigInt(plan.price)) {
          const approveAmount = web3.utils.toWei('10000', 'mwei');
          await usdtContract.methods.approve(CRYPTO_MEMBERSHIP_NFT_ADDRESS, approveAmount)
            .send({ from: currentAccount, gas: 300000 });
          logMessage(`‚úÖ Owner USDT approved`);
        }

        const tx = await nftContract.methods.registerMember(planId, currentAccount)
          .send({ from: currentAccount, gas: 800000 });

        logMessage(`‚úÖ Owner registered Plan ${planId}!`, 'success');
        logMessage(`üìã TX: ${createTxLink(tx.transactionHash)}`);

      } catch (error) {
        throw error;
      }
    }

    async function upgradeOwnerPlan(targetPlan) {
      try {
        const memberInfo = await nftContract.methods.members(currentAccount).call();
        const currentPlan = parseInt(memberInfo.planId);

        for (let plan = currentPlan; plan < targetPlan; plan++) {
          const nextPlan = plan + 1;

          const tx = await nftContract.methods.upgradePlan(nextPlan)
            .send({ from: currentAccount, gas: 800000 });

          logMessage(`‚úÖ Owner upgraded to Plan ${nextPlan}`, 'success');
          await sleep(2000);
        }

      } catch (error) {
        throw error;
      }
    }

    async function executeStep(step) {
      switch (step.action) {
        case 'setup_wallets':
          await setupWallets(step.params.count);
          break;
        case 'fund_wallets':
          await fundAllWallets(step.params.amount);
          break;
        case 'register_first':
          await registerMember(step.params.wallet, step.params.plan, OWNER_ADDRESS);
          break;
        case 'register_chain':
          await registerChain(step.params.wallets, step.params.upline, step.params.plan);
          break;
        case 'register_multi_plan':
          await registerMultiPlan(step.params.registrations);
          break;
        case 'upgrade_sequence':
          await upgradeSequence(step.params.upgrades);
          break;
        // üîπ ‡πÄ‡∏û‡∏¥‡πà‡∏° case ‡πÉ‡∏´‡∏°‡πà
        case 'upgrade_multi_plan':
          await upgradeMultiPlan(step.params.upgrades);
          break;
        case 'owner_register_multi':
          await ownerRegisterMulti(step.params.plans);
          break;
        default:
          logMessage(`‚ö†Ô∏è Unknown step action: ${step.action}`, 'warning');
      }
    }

    async function ownerRegisterMulti(plans) {
      // Note: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ currentAccount (‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Owner) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà test wallet
      for (const planId of plans) {
        if (!isExecuting) break;

        try {
          logMessage(`üëë Owner registering Plan ${planId}...`);

          // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Owner ‡πÄ‡∏õ‡πá‡∏ô member ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          const ownerBalance = await nftContract.methods.balanceOf(currentAccount).call();
          if (parseInt(ownerBalance) > 0) {
            // Owner ‡πÄ‡∏õ‡πá‡∏ô member ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ upgrade
            await upgradeOwnerPlan(planId);
          } else {
            // Owner ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô member ‡πÉ‡∏´‡πâ register ‡∏Å‡πà‡∏≠‡∏ô
            await registerOwner(planId);
          }

        } catch (error) {
          logMessage(`‚ùå Owner registration failed for Plan ${planId}: ${error.message}`, 'error');
        }

        await sleep(3000);
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      logMessage('üß™ BSC Testnet Scenario Tester Ready!');
      logMessage('üí° Select a predefined scenario or build a custom one');
    });

    // Connect to network
    async function connectToNetwork() {
      try {
        if (typeof window.ethereum === 'undefined') {
          throw new Error('MetaMask not found! Please install MetaMask.');
        }

        logMessage('üîÑ Connecting to MetaMask...');

        await window.ethereum.request({ method: 'eth_requestAccounts' });
        web3 = new Web3(window.ethereum);

        // Switch to BSC Testnet
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: BSC_TESTNET.chainId }],
          });
        } catch (switchError) {
          if (switchError.code === 4902) {
            await addBSCTestnet();
          } else {
            throw switchError;
          }
        }

        const accounts = await web3.eth.getAccounts();
        currentAccount = accounts[0];

        // Initialize contracts
        nftContract = new web3.eth.Contract(NFT_ABI, CRYPTO_MEMBERSHIP_NFT_ADDRESS);
        usdtContract = new web3.eth.Contract(USDT_ABI, FAKE_USDT_ADDRESS);

        updateNetworkStatus(true);
        logMessage(`‚úÖ Connected to BSC Testnet: ${shortenAddress(currentAccount)}`, 'success');

      } catch (error) {
        logMessage(`‚ùå Connection failed: ${error.message}`, 'error');
        updateNetworkStatus(false);
      }
    }

    // Add BSC Testnet
    async function addBSCTestnet() {
      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [BSC_TESTNET],
        });
        logMessage('‚úÖ BSC Testnet added to MetaMask', 'success');
      } catch (error) {
        logMessage(`‚ùå Failed to add BSC Testnet: ${error.message}`, 'error');
      }
    }

    // Update network status UI
    function updateNetworkStatus(connected) {
      const indicator = document.getElementById('networkIndicator');
      const name = document.getElementById('networkName');

      if (connected) {
        indicator.className = 'network-indicator';
        name.textContent = 'Connected to BSC Testnet';
      } else {
        indicator.className = 'network-indicator disconnected';
        name.textContent = 'Not Connected to BSC Testnet';
      }
    }

    // Load predefined scenario
    function loadScenario(scenarioKey) {
      if (scenarioKey === 'custom') {
        document.getElementById('customBuilder').style.display = 'block';
        currentScenario = { ...scenarios.custom };
        logMessage('üîß Custom scenario builder activated');
      } else {
        document.getElementById('customBuilder').style.display = 'none';
        currentScenario = { ...scenarios[scenarioKey] };
        logMessage(`üìã Loaded scenario: ${currentScenario.name}`, 'success');
        logMessage(`üìù Description: ${currentScenario.description}`);

        // Enable execute button
        document.getElementById('executeBtn').disabled = false;
      }

      updateProgress(0, `Loaded: ${currentScenario.name}`);
    }
    async function checkIfOwner() {
      try {
        const contractOwner = await nftContract.methods.owner().call();
        const isOwner = currentAccount.toLowerCase() === contractOwner.toLowerCase();

        if (isOwner) {
          logMessage(`üëë Current account is contract owner`, 'success');
        } else {
          logMessage(`‚ÑπÔ∏è Current account is not contract owner`, 'info');
          logMessage(`Contract owner: ${shortenAddress(contractOwner)}`, 'info');
        }

        return isOwner;
      } catch (error) {
        logMessage(`‚ùå Failed to check owner status: ${error.message}`, 'error');
        return false;
      }
    }
    // Generate test wallets
    function generateTestWallets() {
      const count = parseInt(document.getElementById('walletCount').value);
      const testCaseName = document.getElementById('testCaseName').value || 'Custom Test';

      testWallets = [];

      for (let i = 0; i < count; i++) {
        const wallet = web3.eth.accounts.create();
        testWallets.push({
          name: `Wallet ${String.fromCharCode(65 + i)}`,
          address: wallet.address,
          privateKey: wallet.privateKey,
          balance: '0',
          usdtBalance: '0',
          isMember: false,
          planId: 0,
          totalEarnings: '0',
          totalReferrals: 0
        });
      }

      renderWalletGrid();
      document.getElementById('executeBtn').disabled = false;

      logMessage(`‚úÖ Generated ${count} test wallets for: ${testCaseName}`, 'success');
      logMessage('üí° You can now execute your custom scenario');
    }

    // Render wallet grid
    function renderWalletGrid() {
      const grid = document.getElementById('walletGrid');
      grid.innerHTML = '';

      testWallets.forEach((wallet, index) => {
        const walletCard = document.createElement('div');
        walletCard.className = `wallet-card ${wallet.isMember ? 'member' : ''}`;
        walletCard.innerHTML = `
                    <div class="wallet-info">
                        <div class="wallet-name">${wallet.name}</div>
                        <div class="wallet-address">${shortenAddress(wallet.address)}</div>
                    </div>
                    <div class="wallet-stats">
                        <div class="stat-item">
                            <div class="stat-label">BNB</div>
                            <div class="stat-value">${parseFloat(wallet.balance).toFixed(4)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">USDT</div>
                            <div class="stat-value">${parseFloat(wallet.usdtBalance).toFixed(2)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Plan</div>
                            <div class="stat-value">${wallet.isMember ? wallet.planId : 'None'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Earnings</div>
                            <div class="stat-value">${parseFloat(wallet.totalEarnings).toFixed(2)}</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-info" style="font-size: 0.8rem; padding: 5px 10px;" 
                                onclick="fundWallet(${index})">üí∞ Fund</button>
                        <button class="btn btn-success" style="font-size: 0.8rem; padding: 5px 10px;" 
                                onclick="manualRegister(${index})" ${wallet.isMember ? 'disabled' : ''}>
                                üìù Register</button>
                    </div>
                `;
        grid.appendChild(walletCard);
      });
    }

    // Execute scenario
    async function executeScenario() {
      if (!currentScenario || !web3) {
        logMessage('‚ùå Please connect wallet and select a scenario first', 'error');
        return;
      }

      isExecuting = true;
      isPaused = false;
      currentStep = 0;
      executionStartTime = Date.now();

      document.getElementById('executeBtn').disabled = true;
      document.getElementById('pauseBtn').disabled = false;
      document.getElementById('stopBtn').disabled = false;

      logMessage(`üöÄ Starting execution: ${currentScenario.name}`, 'success');

      try {
        for (let i = 0; i < currentScenario.steps.length; i++) {
          if (!isExecuting) break;

          while (isPaused) {
            await sleep(1000);
          }

          currentStep = i;
          const step = currentScenario.steps[i];

          updateProgress((i / currentScenario.steps.length) * 100, `Step ${i + 1}: ${step.action}`);
          logMessage(`üìç Step ${i + 1}/${currentScenario.steps.length}: ${step.action}`);

          await executeStep(step);
          await sleep(2000); // Pause between steps
        }

        if (isExecuting) {
          updateProgress(100, 'Scenario completed successfully!');
          logMessage('üéâ Scenario execution completed successfully!', 'success');

          const duration = (Date.now() - executionStartTime) / 1000;
          logMessage(`‚è±Ô∏è Total execution time: ${duration.toFixed(1)} seconds`);
        }

      } catch (error) {
        logMessage(`‚ùå Scenario execution failed: ${error.message}`, 'error');
        updateProgress(currentStep / currentScenario.steps.length * 100, 'Execution failed');
      } finally {
        isExecuting = false;
        document.getElementById('executeBtn').disabled = false;
        document.getElementById('pauseBtn').disabled = true;
        document.getElementById('stopBtn').disabled = true;
      }
    }

    // Execute individual step
    async function executeStep(step) {
      switch (step.action) {
        case 'setup_wallets':
          await setupWallets(step.params.count);
          break;
        case 'fund_wallets':
          await fundAllWallets(step.params.amount);
          break;
        case 'register_first':
          await registerMember(step.params.wallet, step.params.plan, OWNER_ADDRESS);
          break;
        case 'register_chain':
          await registerChain(step.params.wallets, step.params.upline, step.params.plan);
          break;
        case 'register_multi_plan':
          await registerMultiPlan(step.params.registrations);
          break;
        case 'upgrade_sequence':
          await upgradeSequence(step.params.upgrades);
          break;
        default:
          logMessage(`‚ö†Ô∏è Unknown step action: ${step.action}`, 'warning');
      }
    }

    // Setup wallets
    async function setupWallets(count) {
      testWallets = [];

      for (let i = 0; i < count; i++) {
        const wallet = web3.eth.accounts.create();
        testWallets.push({
          name: `Wallet ${String.fromCharCode(65 + i)}`,
          address: wallet.address,
          privateKey: wallet.privateKey,
          balance: '0',
          usdtBalance: '0',
          isMember: false,
          planId: 0,
          totalEarnings: '0',
          totalReferrals: 0
        });
      }

      renderWalletGrid();
      logMessage(`‚úÖ Created ${count} test wallets`, 'success');
    }

    // Fund all wallets
    async function fundAllWallets(amount) {
      logMessage(`üí∞ Funding all wallets with ${amount} USDT and BNB for gas...`);

      for (let i = 0; i < testWallets.length; i++) {
        // üîπ ‡πÄ‡∏û‡∏¥‡πà‡∏°: Fund BNB ‡∏Å‡πà‡∏≠‡∏ô (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)
        await fundWalletWithBNB(i, '0.05'); // 0.05 BNB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö gas
        await sleep(1000);

        // Fund USDT
        await fundWalletWithUSDT(i, amount);
        await sleep(1000);
      }

      logMessage(`‚úÖ All wallets funded with ${amount} USDT and BNB for gas`, 'success');
    }

    async function fundWalletWithBNB(walletIndex, bnbAmount) {
      try {
        const wallet = testWallets[walletIndex];

        logMessage(`üíé Funding ${wallet.name} with ${bnbAmount} BNB for gas...`);

        const tx = await web3.eth.sendTransaction({
          from: currentAccount,
          to: wallet.address,
          value: web3.utils.toWei(bnbAmount, 'ether'),
          gas: 21000
        });

        wallet.balance = bnbAmount;
        renderWalletGrid();

        logMessage(`‚úÖ ${wallet.name} funded with ${bnbAmount} BNB`, 'success');
        logMessage(`üìã BNB TX: ${createTxLink(tx.transactionHash)}`);

      } catch (error) {
        logMessage(`‚ùå Failed to fund BNB for ${testWallets[walletIndex].name}: ${error.message}`, 'error');
      }
    }

    // Fund individual wallet
    async function fundWallet(index) {
      const usdtAmount = prompt('Enter USDT amount to fund:', '50');
      const bnbAmount = prompt('Enter BNB amount for gas:', '0.05');

      if (bnbAmount && parseFloat(bnbAmount) > 0) {
        await fundWalletWithBNB(index, bnbAmount);
        await sleep(1000);
      }

      if (usdtAmount && parseFloat(usdtAmount) > 0) {
        await fundWalletWithUSDT(index, usdtAmount);
      }
    }

    // Fund wallet with USDT (using faucet function)
    async function fundWalletWithUSDT(index, amount) {
      try {
        const wallet = testWallets[index];
        const amountWithDecimals = web3.utils.toWei(amount, 'mwei'); // 6 decimals for USDT

        // Use the faucet function to get USDT
        const tx = await usdtContract.methods.faucet(wallet.address, amountWithDecimals)
          .send({ from: currentAccount, gas: 200000 });

        wallet.usdtBalance = amount;
        renderWalletGrid();

        logMessage(`üí∞ Funded ${wallet.name} with ${amount} USDT`, 'success');
        logMessage(`üìã TX: ${createTxLink(tx.transactionHash)}`);

      } catch (error) {
        logMessage(`‚ùå Failed to fund ${testWallets[index].name}: ${error.message}`, 'error');
      }
    }

    // Register member
    async function registerMember(walletIndex, planId, uplineAddress) {
      try {
        const wallet = testWallets[walletIndex];
        logMessage(`üìù Registering ${wallet.name} for Plan ${planId}...`);

        // üîπ ‡πÄ‡∏ä‡πá‡∏Ñ BNB balance ‡∏Å‡πà‡∏≠‡∏ô
        const bnbBalance = await web3.eth.getBalance(wallet.address);
        const bnbInEther = web3.utils.fromWei(bnbBalance, 'ether');

        if (parseFloat(bnbInEther) < 0.01) {
          logMessage(`‚ö†Ô∏è ${wallet.name} needs BNB for gas (current: ${bnbInEther} BNB)`, 'warning');

          // Auto fund BNB if needed
          await fundWalletWithBNB(walletIndex, '0.05');
          await sleep(2000); // Wait for BNB transaction
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á account ‡∏à‡∏≤‡∏Å private key
        const account = web3.eth.accounts.privateKeyToAccount(wallet.privateKey);
        web3.eth.accounts.wallet.add(account);

        // üîπ ‡πÄ‡∏ä‡πá‡∏Ñ decimals ‡πÅ‡∏•‡∏∞ plan info
        const usdtDecimals = parseInt(await usdtContract.methods.decimals().call());
        const plan = await nftContract.methods.plans(planId).call();

        // üîπ ‡πÄ‡∏ä‡πá‡∏Ñ allowance
        const allowance = await usdtContract.methods.allowance(wallet.address, CRYPTO_MEMBERSHIP_NFT_ADDRESS).call();
        const allowanceBN = BigInt(allowance.toString());
        const planPriceBN = BigInt(plan.price.toString());

        if (allowanceBN < planPriceBN) {
          logMessage(`üîë Approving USDT for ${wallet.name}...`);

          const approveAmount = web3.utils.toWei('1000', 'mwei'); // Approve 1000 USDT
          const approveTx = await usdtContract.methods.approve(CRYPTO_MEMBERSHIP_NFT_ADDRESS, approveAmount)
            .send({
              from: wallet.address,
              gas: 300000,
              gasPrice: web3.utils.toWei('5', 'gwei')
            });

          logMessage(`‚úÖ USDT approved for ${wallet.name}`);
        }

        // üîπ ‡πÄ‡∏ä‡πá‡∏Ñ USDT balance
        const balance = await usdtContract.methods.balanceOf(wallet.address).call();
        const balanceBN = BigInt(balance.toString());

        if (balanceBN < planPriceBN) {
          throw new Error(`Insufficient USDT balance`);
        }

        // üîπ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô member ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const userBalance = await nftContract.methods.balanceOf(wallet.address).call();
        if (parseInt(userBalance) > 0) {
          throw new Error(`${wallet.name} is already a member`);
        }

        // üîπ Gas estimation with fallback
        let gasEstimate = 800000; // default gas
        try {
          gasEstimate = await nftContract.methods.registerMember(planId, uplineAddress)
            .estimateGas({
              from: wallet.address,
              gas: 3000000
            });
        } catch (gasError) {
          logMessage(`‚ö†Ô∏è Gas estimation failed, using default: ${gasEstimate}`, 'warning');
        }

        const gasWithBuffer = Math.floor(Number(gasEstimate) * 1.2); // 20% buffer

        // üîπ Register member
        logMessage(`üöÄ Submitting registration transaction for ${wallet.name}...`);

        const registerTx = await nftContract.methods.registerMember(planId, uplineAddress)
          .send({
            from: wallet.address,
            gas: gasWithBuffer,
            gasPrice: web3.utils.toWei('5', 'gwei')
          });

        // Update wallet status
        wallet.isMember = true;
        wallet.planId = planId;
        renderWalletGrid();

        logMessage(`‚úÖ ${wallet.name} registered successfully!`, 'success');
        logMessage(`üìã Registration TX: ${createTxLink(registerTx.transactionHash)}`);
        logMessage(`‚õΩ Gas used: ${registerTx.gasUsed}`);

        // Clean up
        web3.eth.accounts.wallet.remove(account);

      } catch (error) {
        console.error("Registration error details:", error);
        logMessage(`‚ùå Failed to register ${testWallets[walletIndex].name}: ${error.message}`, 'error');

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î error
        if (error.code) {
          logMessage(`Error code: ${error.code}`, 'error');
        }
        if (error.receipt) {
          logMessage(`Receipt status: ${error.receipt.status}`, 'error');
        }
      }
    }

    // Register chain (multiple users under one upline)
    async function registerChain(walletIndices, uplineIndex, planId) {
      const uplineAddress = testWallets[uplineIndex].address;

      for (const walletIndex of walletIndices) {
        if (!isExecuting) break;

        await registerMember(walletIndex, planId, uplineAddress);
        await sleep(3000); // Wait 3 seconds between registrations
      }
    }

    // Register multiple plans
    async function registerMultiPlan(registrations) {
      for (const reg of registrations) {
        if (!isExecuting) break;

        let uplineAddress;
        if (reg.upline === 0) {
          // upline 0 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á currentAccount (Owner)
          uplineAddress = currentAccount;
        } else {
          // upline ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ä‡πâ test wallet
          uplineAddress = testWallets[reg.upline].address;
        }

        await registerMember(reg.wallet, reg.plan, uplineAddress);
        await sleep(3000);
      }
    }

    // Upgrade sequence
    async function upgradeSequence(upgrades) {
      for (const upgrade of upgrades) {
        if (!isExecuting) break;

        await upgradeWalletPlan(upgrade.wallet, upgrade.targetPlan);
        await sleep(3000);
      }
    }

    // Upgrade wallet plan
    async function upgradeWalletPlan(walletIndex, targetPlan) {
      try {
        const wallet = testWallets[walletIndex];

        if (!wallet.isMember) {
          throw new Error(`${wallet.name} is not a member yet`);
        }

        logMessage(`‚¨ÜÔ∏è Upgrading ${wallet.name} from Plan ${wallet.planId} to Plan ${targetPlan}...`);

        const account = web3.eth.accounts.privateKeyToAccount(wallet.privateKey);
        web3.eth.accounts.wallet.add(account);

        // Upgrade plan step by step
        for (let currentPlan = wallet.planId; currentPlan < targetPlan; currentPlan++) {
          const nextPlan = currentPlan + 1;

          const upgradeTx = await nftContract.methods.upgradePlan(nextPlan)
            .send({ from: wallet.address, gas: 500000 });

          wallet.planId = nextPlan;
          renderWalletGrid();

          logMessage(`‚úÖ ${wallet.name} upgraded to Plan ${nextPlan}`, 'success');
          logMessage(`üìã Upgrade TX: ${createTxLink(upgradeTx.transactionHash)}`);

          if (nextPlan < targetPlan) {
            await sleep(2000); // Wait between upgrades
          }
        }

        web3.eth.accounts.wallet.remove(account);

      } catch (error) {
        logMessage(`‚ùå Failed to upgrade ${testWallets[walletIndex].name}: ${error.message}`, 'error');
      }
    }

    // Manual register (for individual wallet testing)
    async function manualRegister(index) {
      const planId = prompt('Enter plan ID (1-16):', '1');
      const upline = prompt('Enter upline address (leave empty for owner):', '') || OWNER_ADDRESS;

      if (planId && parseInt(planId) >= 1 && parseInt(planId) <= 16) {
        await registerMember(index, parseInt(planId), upline);
      }
    }

    // Control functions
    function pauseExecution() {
      isPaused = !isPaused;
      const btn = document.getElementById('pauseBtn');
      btn.textContent = isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
      logMessage(isPaused ? '‚è∏Ô∏è Execution paused' : '‚ñ∂Ô∏è Execution resumed', 'warning');
    }

    function stopExecution() {
      isExecuting = false;
      isPaused = false;
      document.getElementById('executeBtn').disabled = false;
      document.getElementById('pauseBtn').disabled = true;
      document.getElementById('stopBtn').disabled = true;
      logMessage('‚èπÔ∏è Execution stopped', 'warning');
    }

    function resetScenario() {
      stopExecution();
      testWallets = [];
      currentScenario = null;
      currentStep = 0;
      document.getElementById('walletGrid').innerHTML = '';
      document.getElementById('executeBtn').disabled = true;
      updateProgress(0, 'Ready to start testing...');
      logMessage('üîÑ Scenario reset', 'info');
    }

    // Update progress
    function updateProgress(percent, text) {
      document.getElementById('progressFill').style.width = `${percent}%`;
      document.getElementById('progressText').textContent = text;
    }

    // Utility functions
    function logMessage(message, type = 'info') {
      const log = document.getElementById('executionLog');
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.innerHTML = `[${timestamp}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function clearLog() {
      document.getElementById('executionLog').innerHTML =
        '<div class="log-entry log-info">[' + new Date().toLocaleTimeString() + '] üìù Log cleared</div>';
    }

    function shortenAddress(address) {
      if (!address) return "";
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    }

    function createTxLink(txHash) {
      return `<a href="https://testnet.bscscan.com/tx/${txHash}" target="_blank" class="tx-link">${txHash.slice(0, 10)}...</a>`;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Export for debugging
    window.scenarioTester = {
      scenarios,
      testWallets,
      currentScenario,
      executeStep,
      logMessage,
      web3: () => web3,
      contracts: () => ({ nft: nftContract, usdt: usdtContract })
    };
  </script>
</body>

</html>